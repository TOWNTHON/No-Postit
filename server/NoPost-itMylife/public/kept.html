<!DOCTYPE html>
<html lang="ja">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Np post-it</title>

</head>
<style>
html {
    height: 100%;
}

body {
    height: 100%;
    margin: 0;
}

.fullheight {
    height: 100%;
    background: #F5F5DC;
}
</style>
<body　>
    <div class="fullheight">
        <img src="img/kept.png" style = "width: 100% ; height : 100%"/>
    </div>
    <input type="file" id="fileInput"></input>
    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/socket.io.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!-- socketio-->
    <script type="text/javascript">

  //  var s = io.connect(); //リモート
    var s = io.connect('http://52.26.19.108:3000'); //ローカル

    //サーバから受け取るイベント
    s.on("connect", function () {});  // 接続時
    s.on("disconnect", function (client) {});  // 切断時
    s.on("S_to_C_message", function (data) {
      addMessage(data.value);
    });
    s.on("S_to_C_img", function (data) {
      // 生成する文字列の長さ
      var l = 8;
      // 生成する文字列に含める文字セット
      var c = "abcdefghijklmnopqrstuvwxyz0123456789";
      var cl = c.length;
      var r = "";
      for(var i=0; i<l; i++){
        r += c[Math.floor(Math.random()*cl)];
      }
      var id = "img-" + r;
      var img = data.value;
      $('.fullheight').append('<img id='+ id + ' style="width: 80px; height: 110px; position: absolute; right: 50%; bottom: 50%;"/>');
      $( "#" + id).attr("src",img);
      $( "#" + id).draggable();
      window.localStorage.setItem(id, img);
    });

    //クライアントからイベント送信（イベント名は自由に設定できます）
    function sendMessage() {
      var msg = $("#message").val(); //取得
      $("#message").val(""); //空白にする
      s.emit("C_to_S_message", {value:msg}); //サーバへ送信
    }

    function sendBroadcast() {
      var msg = $("#message").val(); //取得
      $("#message").val(""); //空白にする
      s.emit("C_to_S_broadcast", {value:msg}); // サーバへ送信
    }

    //jqueryでメッセージを追加
    function addMessage (value,color,size) {
      var msg = value.replace( /[!@$%<>'"&|]/g, '' ); //タグ記号とかいくつか削除
      $("#msg_list").prepend("<div class='msg'>" + msg + "</div>");
    }    

  </script>

  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" />
  <script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
  <style>
  #draggable { width: 80px; height: 110px; padding: 0.5em; }
  </style>
  <script>
  $(function() {
    $( "#0001" ).draggable();
  });

  function upload(file){

       var fileReader = new FileReader();
       var send_file = file;
       var type = send_file.type;//♪L( ՞ਊ ՞)┘└( ՞ਊ ՞)」♪
       var data = {};
   
       fileReader.readAsDataURL(send_file);
   
       fileReader.onload = function(event) {
           data.file = event.target.result;
           data.name = "uploadFile";
           data.type = type;//♪L( ՞ਊ ՞)┘└( ՞ਊ ՞)」♪

           s.emit('upload',data);
   
       }

  }

  $(document).ready(function(){

     $("#fileInput").change(function(event){
 
         var file = event.target.files[0];
         upload(file);//ファイルを送る関数
 
      });

});


  </script>

</body>

</html>